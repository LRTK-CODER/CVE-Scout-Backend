import os
import json
import pytz
import requests
import time
from datetime import datetime, timedelta
from typing import Optional, Dict, Any, List


class NVD_CVE_Parser:
    def __init__(self, api_url: str, api_key: str):
        self.api_url = api_url
        self.headers = {"apiKey": api_key}
        self.seoul_tz = pytz.timezone("Asia/Seoul")

    def fetch_cve_data(self, start_index: int, results_per_page: int) -> Optional[List[Dict[str, Any]]]:
        url = f"{self.api_url}/?resultsPerPage={results_per_page}&startIndex={start_index}"
        response_json = self._get_response(url)

        if response_json is None:
            return None

        cve_data = response_json["vulnerabilities"]

        return cve_data
