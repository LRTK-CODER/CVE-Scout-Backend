#!/bin/bash

# The script expects the filename as the first argument
TARGET_DIRECTORY=$1

# Check if filename is provided
if [ -z "$TARGET_DIRECTORY" ]; then
    echo "Error: No filename provided."
    exit 1
fi


# Run syft and check for errors
syft dir:$TARGET_DIRECTORY -o json >$TARGET_DIRECTORY/sbom.json
if [ $? -ne 0 ]; then
    echo "Error: syft command failed."
    exit 2
fi

# Run grype and check for errors
grype sbom:$TARGET_DIRECTORY/sbom.json -o json > $TARGET_DIRECTORY/vuln_list.json
if [ $? -ne 0 ]; then
    echo "Error: grype command failed."
    exit 3
fi

# Return success
echo "successfully."
exit 0
